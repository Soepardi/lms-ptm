<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daftar Akun Baru - Pesantren Teknologi Majapahit</title>
    <link rel="icon" type="image/x-icon" href="../assets/images/favicon.ico">

    <!-- Alpine.js -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <!-- Tailwind CSS & DaisyUI -->
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.1.0/dist/full.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../assets/js/utils/supabase-client.js"></script>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="../assets/css/styles.css">
</head>

<body class="min-h-screen bg-white flex">

    <!-- Left Column: Visual (Hidden on Mobile) -->
    <div class="hidden lg:flex w-1/2 bg-[#F3F2F1] relative items-center justify-center overflow-hidden">
        <!-- Modern Abstract Background -->
        <div
            class="absolute w-[800px] h-[800px] bg-gradient-to-tr from-[#0078D4]/20 to-[#50E6FF]/20 rounded-full blur-3xl bottom-[10%] -left-[20%] animate-pulse">
        </div>
        <div
            class="absolute w-[500px] h-[500px] bg-gradient-to-bl from-[#005A9E]/10 to-transparent rounded-full blur-3xl top-[10%] right-[10%]">
        </div>

        <div class="relative z-10 p-12 max-w-xl text-center">
            <img src="../assets/images/logo.png" alt="Logo"
                class="w-24 h-24 object-contain mx-auto mb-6 animate-fade-in drop-shadow-xl">

            <h2 class="text-4xl font-bold text-[#323130] mb-6 leading-tight animate-fade-in">
                Mulai Perjalanan Anda Menjadi <br>
                <span class="text-[#0078D4]">Talenta Digital</span>
            </h2>

            <p class="text-lg text-[#605E5C] leading-relaxed mb-10 animate-fade-in" style="animation-delay: 0.1s">
                Bergabunglah dengan ribuan santri lainnya dalam ekosistem pembelajaran teknologi berbasis pesantren
                pertama di Indonesia.
            </p>

            <div class="grid grid-cols-2 gap-4 text-left animate-fade-in" style="animation-delay: 0.2s">
                <div class="p-4 bg-white/60 backdrop-blur rounded-xl border border-white/50 shadow-sm">
                    <ion-icon name="code-slash" class="text-2xl text-[#0078D4] mb-2"></ion-icon>
                    <h4 class="font-bold text-[#323130]">Skill Praktis</h4>
                    <p class="text-sm text-[#605E5C]">Materi relevan industri</p>
                </div>
                <div class="p-4 bg-white/60 backdrop-blur rounded-xl border border-white/50 shadow-sm">
                    <ion-icon name="heart-circle" class="text-2xl text-[#ea580c] mb-2"></ion-icon>
                    <h4 class="font-bold text-[#323130]">Komunitas</h4>
                    <p class="text-sm text-[#605E5C]">Jaringan alumni kuat</p>
                </div>
                <div class="p-4 bg-white/60 backdrop-blur rounded-xl border border-white/50 shadow-sm">
                    <ion-icon name="ribbon" class="text-2xl text-[#9333ea] mb-2"></ion-icon>
                    <h4 class="font-bold text-[#323130]">Sertifikasi</h4>
                    <p class="text-sm text-[#605E5C]">Diakui perusahaan</p>
                </div>
                <div class="p-4 bg-white/60 backdrop-blur rounded-xl border border-white/50 shadow-sm">
                    <ion-icon name="time" class="text-2xl text-[#16a34a] mb-2"></ion-icon>
                    <h4 class="font-bold text-[#323130]">Fleksibel</h4>
                    <p class="text-sm text-[#605E5C]">Belajar kapan saja</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Column: Form -->
    <div
        class="w-full lg:w-1/2 flex flex-col justify-center items-center p-8 md:p-12 relative animate-fade-in overflow-y-auto max-h-screen">
        <a href="../index.html"
            class="absolute top-8 left-8 flex items-center gap-2 text-[#605E5C] hover:text-[#0078D4] transition-colors font-semibold text-sm group z-10">
            <div
                class="w-8 h-8 rounded-full bg-[#F3F2F1] flex items-center justify-center transition-colors group-hover:bg-[#EFF6FC]">
                <ion-icon name="arrow-back"></ion-icon>
            </div>
            <span>Kembali ke Beranda</span>
        </a>

        <div class="w-full max-w-sm mt-12 md:mt-0">
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-[#323130] mb-3">Buat Akun Baru</h1>
                <p class="text-[#605E5C]">Lengkapi data diri untuk memulai.</p>
            </div>

            <form x-data="signupForm" @submit.prevent="handleSignup" class="space-y-5">

                <div>
                    <label class="block text-xs font-semibold uppercase tracking-wider text-[#605E5C] mb-2">Nama
                        Lengkap</label>
                    <div class="relative">
                        <input type="text" x-model="fullName" placeholder="Contoh: Ahmad Fulan"
                            class="input-fluent w-full pl-10 h-11 bg-[#F3F2F1] focus:bg-white transition-colors border-transparent focus:border-[#0078D4]"
                            required />
                        <ion-icon name="person-outline"
                            class="absolute left-3.5 top-3.5 text-lg text-[#605E5C]"></ion-icon>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-semibold uppercase tracking-wider text-[#605E5C] mb-2">Email
                        Address</label>
                    <div class="relative">
                        <input type="email" x-model="email" placeholder="nama@email.com"
                            class="input-fluent w-full pl-10 h-11 bg-[#F3F2F1] focus:bg-white transition-colors border-transparent focus:border-[#0078D4]"
                            required />
                        <ion-icon name="mail-outline"
                            class="absolute left-3.5 top-3.5 text-lg text-[#605E5C]"></ion-icon>
                    </div>
                </div>

                <div>
                    <label
                        class="block text-xs font-semibold uppercase tracking-wider text-[#605E5C] mb-2">Password</label>
                    <div class="relative">
                        <input :type="showPassword ? 'text' : 'password'" x-model="password"
                            placeholder="Buat password aman"
                            class="input-fluent w-full pl-10 pr-10 h-11 bg-[#F3F2F1] focus:bg-white transition-colors border-transparent focus:border-[#0078D4]"
                            required />
                        <ion-icon name="lock-closed-outline"
                            class="absolute left-3.5 top-3.5 text-lg text-[#605E5C]"></ion-icon>
                        <button type="button" @click="showPassword = !showPassword"
                            class="absolute right-3.5 top-3.5 text-lg text-[#605E5C] hover:text-[#323130] focus:outline-none">
                            <ion-icon :name="showPassword ? 'eye-off-outline' : 'eye-outline'"></ion-icon>
                        </button>
                    </div>
                </div>

                <div>
                    <label class="block text-xs font-semibold uppercase tracking-wider text-[#605E5C] mb-3">Saya ingin
                        mendaftar sebagai</label>
                    <div class="grid grid-cols-2 gap-4">
                        <label
                            class="cursor-pointer border-2 rounded-xl p-3 flex flex-col items-center gap-2 transition-all hover:bg-[#F3F2F1] relative group"
                            :class="role === 'student' ? 'border-[#0078D4] bg-[#EFF6FC]' : 'border-[#EDEBE9]'">
                            <input type="radio" name="role" value="student" x-model="role"
                                class="absolute opacity-0 w-full h-full cursor-pointer">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center transition-colors"
                                :class="role === 'student' ? 'bg-[#0078D4] text-white' : 'bg-[#F3F2F1] text-[#605E5C]'">
                                <ion-icon name="school" class="text-xl"></ion-icon>
                            </div>
                            <span class="text-sm font-bold"
                                :class="role === 'student' ? 'text-[#0078D4]' : 'text-[#323130]'">Siswa</span>
                        </label>

                        <label
                            class="cursor-pointer border-2 rounded-xl p-3 flex flex-col items-center gap-2 transition-all hover:bg-[#F3F2F1] relative group"
                            :class="role === 'instructor' ? 'border-[#0078D4] bg-[#EFF6FC]' : 'border-[#EDEBE9]'">
                            <input type="radio" name="role" value="instructor" x-model="role"
                                class="absolute opacity-0 w-full h-full cursor-pointer">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center transition-colors"
                                :class="role === 'instructor' ? 'bg-[#0078D4] text-white' : 'bg-[#F3F2F1] text-[#605E5C]'">
                                <ion-icon name="easel" class="text-xl"></ion-icon>
                            </div>
                            <span class="text-sm font-bold"
                                :class="role === 'instructor' ? 'text-[#0078D4]' : 'text-[#323130]'">Pengajar</span>
                        </label>
                    </div>
                </div>

                <div x-show="errorMessage" x-transition
                    class="p-3 rounded-lg bg-red-50 border border-red-100 flex items-center gap-2 text-red-600 text-sm font-medium">
                    <ion-icon name="alert-circle"></ion-icon>
                    <span x-text="errorMessage"></span>
                </div>

                <button type="submit"
                    class="w-full btn-fluent btn-primary-fluent h-12 text-base shadow-lg shadow-[#0078D4]/20 hover:shadow-[#0078D4]/40 hover:-translate-y-0.5 mt-2"
                    :disabled="loading">
                    <span x-show="!loading" class="flex items-center justify-center gap-2">
                        Daftar Sekarang <ion-icon name="arrow-forward"></ion-icon>
                    </span>
                    <span x-show="loading" class="loading loading-spinner loading-sm"></span>
                </button>

                <p class="text-center text-sm text-[#605E5C] mt-6">
                    Sudah punya akun?
                    <a href="login.html" class="text-[#0078D4] font-bold hover:underline transition-colors">Masuk
                        disini</a>
                </p>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('alpine:init', () => {
            Alpine.data('signupForm', () => ({
                fullName: '',
                email: '',
                password: '',
                role: 'student',
                showPassword: false,
                loading: false,
                errorMessage: '',

                async handleSignup() {
                    this.loading = true;
                    this.errorMessage = '';
                    try {
                        const { data, error } = await supabase.auth.signUp({
                            email: this.email,
                            password: this.password,
                            options: {
                                data: {
                                    full_name: this.fullName,
                                    role: this.role
                                }
                            }
                        });


                        if (error) throw error;

                        if (data.user) {
                            alert('Pendaftaran berhasil! Silakan cek email Anda untuk verifikasi atau langsung login.');
                            window.location.href = 'login.html';
                        }

                    } catch (error) {
                        this.errorMessage = error.message;
                    } finally {
                        this.loading = false;
                    }
                }
            }))
        })
    </script>
</body>

</html>